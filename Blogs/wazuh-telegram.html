<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog | SR</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <nav class="navbar">
        <div class="logo">&lt;SR.Sec /&gt;</div>
        <ul class="nav-links">
            <li><a href="/index.html">Back to Home</a></li>
        </ul>
    </nav>

    <header class="blog-header-section">
        <div class="container">
            <span class="blog-date-large">April 20, 202</span>
            <h1 class="article-title">Integrating Wazuh with Telegram for Alert Notifications</h1>
            <div class="tags">
                <span>Wazuh</span>
                <span>Telegram</span>
                <span>Blue Team</span>
            </div>
        </div>
    </header>

    <main>
        <article class="blog-content-wrapper fade-in-up">
            
            <p class="intro-text">
                In this article, I will explain how to route Wazuh alerts to Telegram.
            </p>

            <h3>1. Creating the Bot</h3>
            <p>
                First, you need to activate a <strong>Telegram</strong> bot using <strong>BotFather</strong>.
            </p>
            <img src="Wazuh-Telegram/botfather.png" alt="Telegram Bot" class="article-img">
            <p>
                In the section marked in red in the image, you will be provided with an HTTP API Token (I have hidden mine for security purposes).
            </p>

            <h3>2. Getting the Chat ID</h3>
            <p>
                Next, create a group and add this bot to it.
            </p>

            <img src="Wazuh-Telegram/group-telegram.png" alt="Telegram group" class="article-img">
            <p>
                In the section marked above, you can see the group's <strong>Chat ID</strong>.
            </p>
            <p>
                Alternatively, you can get the Chat ID by adding your Bot API token to the URL below and sending a request. It will return a response in JSON format. You can also use <strong>Sean Bradley's</strong> script to obtain the Chat ID.
            </p>
            <ul>
                <li><strong>API URL:</strong> <code>https://api.telegram.org/bot&lt;bot API&gt;/getUpdates</code></li>
                <li><strong>Guide:</strong> <a href="https://sean-bradley.medium.com/get-telegram-chat-id-80b575520659" target="_blank">How to get a Chat ID of a Telegram Group</a></li>
            </ul>
            <h3>3. Setting up the Script</h3>
            <p>
                Next, we need to run a script for Wazuh to send the alerts. For this, I will use the script from the <strong>Demos</strong> repository linked below:
            </p>
            <p><strong>Step 3.1: Create the files</strong> <br>
            Navigate to the <code>/var/ossec/integrations</code> directory.
            </p>
            <ol>
                <li>
                    Create a file named <code>custom-telegram</code> (this will be the bash script launcher).
                </li>
                <li>
                    Create a file named <code>custom-telegram.py</code> and copy the code below into it.
                </li>
            </ol> <br>
            <p><em>The script below is a version of the Demos script that I adapted for my system and customized to make the output look cleaner.</em></p>
            <p><strong>Python Script (<code>custom-telegram.py</code>):</strong></p>

            <div class="code-container">
    <button class="copy-btn">Copy</button>
    <pre><code>#!/usr/bin/env python3

import sys
import json
import requests
from requests.auth import HTTPBasicAuth

# CHAT_ID="xxxx"
CHAT_ID = ""

# Read configuration parameters
alert_file = open(sys.argv[1])
hook_url = sys.argv[3]

# Read the alert file
alert_json = json.loads(alert_file.read())
alert_file.close()


# Extract data fields
date = alert_json['timestamp'] if 'timestamp' in alert_json else "N/A"
agent = alert_json['agent']['name'] if 'name' in alert_json['agent'] else "N/A"
srcip=alert_json['agent']['ip'] if 'ip' in alert_json['agent'] else "N/A"
payload = alert_json['data']['url'] if 'url' in alert_json['data'] else "N/A"
alert_level = alert_json['rule']['level'] if 'level' in alert_json['rule'] else "N/A"
description = alert_json['rule']['description'] if 'description' in alert_json['rule'] else "N/A"

# Generate request
msg_data = {}
msg_data['chat_id'] = CHAT_ID
msg_data['text'] = f"Date: {date}\nAgent Name: {agent}\nSource IP: {srcip}\nPayload: {payload}\nAlert Level: {alert_level}\nDescription: {description}"
headers = {'content-type': 'application/json', 'Accept-Charset': 'UTF-8'}

# Send the request
requests.post(hook_url, headers=headers, data=json.dumps(msg_data))

sys.exit(0)</code></pre>
</div>
<p><strong>Important:</strong> Make sure to add your ID (usually starting with <code>-</code> for groups) to the <code>CHAT_ID</code> variable in the script.</p>
<h3>4. Configuring Wazuh</h3>
    <p>The only remaining part is to add the API bot configuration to Wazuh.</p>
    <ol>
        <li>Open the <code>/var/ossec/etc/ossec.conf</code> file.</li>
        <li>Add the configuration shown at the bottom of the <strong>Demos</strong> page (linked above) inside the <code>&lt;ossec_config&gt;&lt;/ossec_config&gt;</code> tags.</li>
        <li><strong>Note:</strong> Pay close attention to indentation/spaces to avoid system errors.</li>
    </ol>

    <h3>5. Permissions and Restart</h3>
    <p>We finalize the configuration by assigning the necessary permissions to the files and restarting the manager.</p>

    <div class="code-container">
        <button class="copy-btn">Copy</button>
        <pre><code>
chown root:wazuh /var/ossec/integrations/custom-telegram*
chmod 750 /var/ossec/integrations/custom-telegram*
systemctl restart wazuh-manager
        </code></pre>

    </div>

    <h3>6. Verification</h3>
    <p>The notification received when I performed a test SQLi attack looks like this:</p>

    <img src="Wazuh-Telegram/sqli-attack-result.png" alt="Wazuh Alert on Telegram Screenshot" class="article-img"> <br> <br>

    <h4>References:</h4>
    <ul>
        <li><a href="https://sean-bradley.medium.com/get-telegram-chat-id-80b575520659" target="_blank">Sean Bradley - Get Telegram Chat ID</a></li>
        <li><a href="https://github.com/OpenSecureCo/Demos/blob/main/Telegram%20Integration" target="_blank">OpenSecureCo Demos - Telegram Integration</a></li>
    </ul>
            <div class="article-footer">
                <a href="/index.html" class="btn secondary-btn">&larr; Return to Portfolio</a>
            </div>

        </article>
    </main>

    <footer>
        <p>&copy; 2026 Sanan Rahimli. All Systems Operational.</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>